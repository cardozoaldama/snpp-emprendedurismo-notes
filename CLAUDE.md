# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

This is a LuaLaTeX-based educational document project that compiles "Competencias Emprendedoras" (Entrepreneurial Skills), educational materials for a Paraguayan audience. The project uses GitHub Actions for automated PDF compilation and versioned releases.

## Building the Document

### Local Compilation

```bash
cd latex
lualatex main.tex
lualatex main.tex  # Second pass required for references
```

The output PDF will be `latex/main.pdf`.

### CI/CD Pipeline

- **Every push to `main`**: Builds PDF artifact (available for 30 days)
- **Tags on `main`**: Creates GitHub Release with downloadable PDFs

## Document Architecture

The LaTeX project is modular with a clear separation of concerns:

- **`latex/main.tex`**: Document orchestrator that pulls everything together
- **`latex/preamble.tex`**: Package configuration and document class setup (KOMA-Script scrartcl, 12pt, A4)
- **`latex/commands.tex`**: Custom callout environments (tip, note, important, warning)
- **`latex/version.tex`**: Auto-generated version information (CI inserts version, build date, commit hash)
- **`latex/content/*.tex`**: Individual content modules organized by topic

### Key LaTeX Features

- Uses **LuaLaTeX** engine (required, not pdfLaTeX)
- Spanish language support with `babel` package
- Typography optimization with `microtype` and widow/orphan control
- Custom callout boxes (`callouttip`, `calloutnote`, `calloutimportant`, `calloutwarning`)
- KOMA-Script for professional document layout
- Version information auto-inserted in footer: `\docversion`, `\builddate`, `\gitcommit`

## Versioning and Releases

Follows **Semantic Versioning** (`vMAJOR.MINOR.PATCH`):

- **MAJOR**: Breaking changes, major reorganization
- **MINOR**: New sections/chapters, significant content additions
- **PATCH**: Typo fixes, typography improvements, formatting

### Creating Releases

**Method 1: Automated (Recommended)**
1. Go to Actions â†’ "Prepare Release"
2. Run workflow with version type (major/minor/patch)
3. Optionally mark as pre-release (adds `-draft` suffix)

**Method 2: Manual Tag**
```bash
git tag -a v1.2.3 -m "Release v1.2.3"
git push origin v1.2.3
```

Pre-release tags: `v1.0.0-draft`, `v1.0.0-rc`

### Release Process

When a tag is pushed to `main`:
1. `prepare-release.yml` or manual tag triggers `build-latex.yml`
2. Version info extracted and injected into `latex/version.tex`
3. Document compiled with LuaLaTeX (two passes)
4. Two PDFs generated:
   - `competencias-emprendedoras-vX.Y.Z.pdf` (versioned)
   - `competencias-emprendedoras.pdf` (stable link)
5. GitHub Release created with both PDFs attached

## Specialized Agents

This repository includes custom Claude agents in `.claude/agents/`:

- **lualatex-consultant**: For design decisions, package selection, troubleshooting LaTeX
- **lualatex-scribe**: For generating LaTeX code from specifications
- **ci-pipeline-consultant**: For designing/troubleshooting GitHub Actions workflows
- **ci-pipeline-scribe**: For generating workflow YAML files
- **document-qa-inspector**: For validating document quality and compliance
- **git-commit-composer**: For crafting meaningful commit messages

Use these agents when working on LaTeX content, CI/CD pipelines, or document quality tasks.

## Development Guidelines

### When Editing Content

- Content files are in `latex/content/` numbered by module (01, 02, etc.)
- Follow existing callout conventions for tips, notes, warnings
- Test compilation locally before pushing
- Version bumps are handled via tags, not manual edits to `version.tex`

### When Modifying LaTeX Structure

- Package configuration goes in `preamble.tex`
- Custom commands/environments go in `commands.tex`
- Do not edit `version.tex` manually (auto-generated by CI)
- Typography controls are already optimized (widow/orphan penalties, page breaking)

### When Changing CI/CD

- `build-latex.yml`: Handles compilation and release creation
- `prepare-release.yml`: Automates version calculation and tagging
- Both workflows require LuaLaTeX (not pdfLaTeX)
- Version extraction logic in `build-latex.yml` handles both tags and dev builds

## Important Notes

- **Always use LuaLaTeX**, not pdfLaTeX (required by fontspec and modern typography)
- Two compilation passes are required for proper ToC and references
- The footer displays version info automatically via `\docversion`, `\builddate` macros
- Releases should only be created from `main` branch
- Pre-releases are automatically detected by `-draft`, `-rc`, or `-dev` in version string
